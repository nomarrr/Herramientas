<div class="commenter-container">
  <div class="header">
    <h2>
      💬 Comentarios de Categorías
    </h2>
  </div>

  <div class="categorias-container">
    <mat-accordion>
      <mat-expansion-panel *ngFor="let categoria of categorias" class="categoria-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{categoria.nombre}}
          </mat-panel-title>
          <mat-panel-description>
            {{(comentarios[categoria.id] || []).length}} comentarios
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- Sección de Ideas -->
        <div class="ideas-section">
          <h3>
            <span class="icon">💡</span>
            Ideas en esta categoría
            <span class="contador" *ngIf="ideas && ideas[categoria.id]">
              {{ideas[categoria.id].length}}
            </span>
          </h3>
          
          <div class="ideas-grid" *ngIf="ideas && ideas[categoria.id] && ideas[categoria.id].length > 0">
            <div class="idea-card" *ngFor="let idea of ideas[categoria.id]">
              <div class="idea-content">
                <div class="idea-header">
                  <span class="idea-texto">{{idea.texto}}</span>
                </div>
                <div class="idea-footer">
                  <span class="idea-autor">Por: {{idea.autor}}</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="empty-state" *ngIf="!ideas || !ideas[categoria.id] || ideas[categoria.id].length === 0">
            <span class="icon">📝</span>
            <p>No hay ideas en esta categoría</p>
          </div>
        </div>

        <!-- Lista de comentarios -->
        <div class="comentarios-lista">
          <h3>
            <span class="icon">💬</span>
            Comentarios
          </h3>

          <div class="empty-state" *ngIf="!comentarios[categoria.id] || comentarios[categoria.id].length === 0">
            <span class="icon">📭</span>
            <p>No hay comentarios en esta categoría</p>
          </div>

          <div class="comentario-card" *ngFor="let comentario of comentarios[categoria.id]">
            <div class="comentario-header">
              <span class="comentario-usuario">Usuario ID: {{comentario.idUsuario}}</span>
            </div>
            <div class="comentario-texto">{{comentario.comentarios}}</div>
            <div class="comentario-actions" *ngIf="comentario.idUsuario === idUsuario">
              <button mat-icon-button color="primary" (click)="editarComentario(categoria.id, comentario)" matTooltip="Editar comentario">
                ✏️
              </button>
              <button mat-icon-button color="warn" (click)="eliminarComentario(categoria.id, comentario.id)" matTooltip="Eliminar comentario">
                🗑️
              </button>
            </div>
          </div>

          <!-- Formulario para nuevo comentario -->
          <div class="nuevo-comentario">
            <mat-form-field appearance="outline" class="comentario-input">
              <mat-label>Agregar comentario</mat-label>
              <textarea matInput
                        [(ngModel)]="nuevoComentario[categoria.id]"
                        placeholder="Escriba su comentario aquí..."
                        rows="3">
              </textarea>
            </mat-form-field>
            <button mat-raised-button
                    color="primary"
                    (click)="agregarComentario(categoria.id)"
                    [disabled]="!nuevoComentario[categoria.id] || !nuevoComentario[categoria.id].trim()">
              Agregar Comentario
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div> 